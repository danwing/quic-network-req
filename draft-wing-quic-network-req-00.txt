



QUIC                                                             D. Wing
Internet-Draft                                                     Cisco
Intended status: Standards Track                           June 13, 2016
Expires: December 15, 2016


                     Network Requirements for QUIC
                     draft-wing-quic-network-req-00

Abstract

   Identifying QUIC traffic benefits both QUIC and network security, as
   described by this document.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on December 15, 2016.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.






Wing                    Expires December 15, 2016               [Page 1]

Internet-Draft        Network Requirements for QUIC            June 2016


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Rate Limiting and Consent to Receive  . . . . . . . . . . . .   2
   3.  Long-lived Connections and HTTP Server Push . . . . . . . . .   3
   4.  QUIC Version ID . . . . . . . . . . . . . . . . . . . . . . .   3
   5.  Endpoint State Loss . . . . . . . . . . . . . . . . . . . . .   4
   6.  Network State Loss  . . . . . . . . . . . . . . . . . . . . .   5
   7.  Network Diagnostics . . . . . . . . . . . . . . . . . . . . .   5
   8.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
   9.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
   10. References  . . . . . . . . . . . . . . . . . . . . . . . . .   5
     10.1.  Normative References . . . . . . . . . . . . . . . . . .   5
     10.2.  Informative References . . . . . . . . . . . . . . . . .   6
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .   7

1.  Introduction

   Middleboxes, especially firewalls and NATs, have contributed to the
   inability of the Internet to evolve
   [I-D.hildebrand-middlebox-erosion].  There is a strong desire to
   avoid this ossification with QUIC.  At the same time, there is a
   desire to treat QUIC better than normal UDP traffic; that is, to
   treat QUIC as well as TCP traffic.  Unfortunately, the lack of header
   information in QUIC prevents the network from identifying QUIC
   traffic and prevents the network from treating QUIC as a transport
   protocol on par with TCP.

   This paper assumes that QUIC will use TLS 1.3 and will not perform
   TLS session resumption when switching interfaces; rather, it will
   simply send its Connection ID on its new interface.  This means TLS
   1.3 will be bound to QUIC's Connection ID, rather than bound to the
   connection 5-tuple (IP source/destination, protocol, port source/
   destination).

2.  Rate Limiting and Consent to Receive

   On many networks, UDP is rate-limited or completely blocked.  The
   rate limiting is per host or per link (that is, an aggregate of all
   the traffic generated by each user).  These limits are not done
   capricously; rather, the limits are imposed to prevent compromised
   hosts from generating high volumes of UDP traffic towards a victim
   [I-D.byrne-opsec-udp-advisory].

   Unlike UDP, TCP has a clear consent-to-receive indicator, which is
   why TCP does not suffer from rate-limits on those same networks.  For
   TCP, the network can observe the consent to receive by patching
   acknowledgement numbers with their associated sequence numbers.



Wing                    Expires December 15, 2016               [Page 2]

Internet-Draft        Network Requirements for QUIC            June 2016


   WebRTC's data channel runs over UDP and has network-observable
   Consent Freshness [RFC7675] packets.  Multipath TCP (MPTCP [RFC6824])
   sends its acknowledgements on the (reverse) path of the data.

   However, QUIC does not provide consent information visible to the
   network, and QUIC is silent if its own acknowledgements would be sent
   on the (reverse) path of the data.  Without this visibility, QUIC
   traffic that a host wants to receive cannot be distinguished from
   attack traffic.

      Recommendation: Provide network-visible QUIC identifier for
      consent request and consent acknowledgement packets, and always
      send acknowledgement packets to inverted 5 tuple of the consent
      request packets.

3.  Long-lived Connections and HTTP Server Push

   Although the recommended UDP timeout for arbitrary ports is two
   minutes (Section 4.3 of [RFC4787]), some residential CPE devices have
   a 30 second timeout and a majority have a three minute timeout
   ([homeCPE], [tsvarea]).  Longer timeouts are provided to connection-
   oriented TCP -- 4 minutes during connection establishment and 2 hours
   after connection establishment [homeCPE].

   Such short timers are not a problem if the mapping is destroyed and
   the client sends data first, as a new mapping will be created and
   QUIC handles a new mapping (on a new UDP port or even on a new IP
   address) without an additional round-trip with its Connection Id.
   However, if the mapping is destroyed and the server sends data first,
   the server's packets will be dropped by the firewall or NAT.  This
   problem can be mitigated by (a) the client identifying its long-lived
   connections to the network (e.g., using PCP or UPnP IGD) or (b) by
   using an easily-identified QUIC header so the network can hopefully
   identify that header and apply a longer, TCP-like mapping.  Neither
   is a perfect solution.  Note that heuristic NAT / firewall beahavior
   discovery is tempting, but imperfect [RFC5780], leaving QUIC with
   needing to send occasional keepalivers as the best assurance against
   mapping destruction.

      Recommendation: Provide network-visible QUIC identifier so network
      can provide longer mapping lifetime.

4.  QUIC Version ID

   When joining a new network with an existing QUIC session, the QUIC
   Version is not sent.  This reduces QUIC identification to heuristics
   which are fragile.  Without stronger QUIC identification, the other
   features described in this document cannot be attained.



Wing                    Expires December 15, 2016               [Page 3]

Internet-Draft        Network Requirements for QUIC            June 2016


      Recommendation: Re-joining an existing QUIC session should be
      clearly identifyable by the network.

5.  Endpoint State Loss

   When an endpoint (client or server) loses state due to a reboot, or a
   host acquires a previously-active QUIC host's IP address, there may
   be spurious QUIC packets that arrives to a host.  The host might have
   a QUIC application listening on that socket, a non-QUIC application
   listening on that socket, or no application listening on that socket.
   These are described below.

   QUIC application listening: If the socket is expecting QUIC traffic
   and receives a spurious QUIC packet, the QUIC Connection ID will not
   match an existing Connection ID, and it should generate a QUIC reset
   packet.  The reset packet has to contain the full 64-bit Connection
   ID.  If the offending packet was using a truncated (compressed)
   Connect ID, the endpoint cannot generate a QUIC reset packet with the
   necessary 64-bit Connection ID (Sections 5.5 and 6.2.2 of
   [I-D.tsvwg-quic-protocol]).

      Recommendation: QUIC should honor a QUIC reset matching the
      (inverted) 5-tuple of the remote peer and its recently-sent
      Connection ID.

   Non-QUIC application listening: If the socket is not a QUIC
   application, it will not expect to receive a QUIC packet.  Upon
   receiving a QUIC packet, that application will either ignore not
   generate a response or will generate a response appropriate for that
   application (perhaps "unable to parse" or some similar response).  If
   the application does generate a response it will be received by the
   QUIC sender, the QUIC Connection ID of that response will not match
   an existing Connection ID, and non-QUIC packet will be dropped by
   QUIC.

      Recommendation: no change.

   No application listening: If there is no process listening on that
   UDP socket, the host will generate an ICMP or ICMP6 error
   (destination unreachable, port unreachable).  Most operating systems
   allow non-privileged applications to receive and parse ICMP errors,
   allowing the QUIC stack to validate the returned ICMP error
   [ICMPTest].

      Recommendation: QUIC should honor an ICMP hard error matching the
      5-tuple of the remote peer and its recently-sent Connection ID, in
      a fashion similar to TCP's handling of ICMP hard errors (Section 4
      of [RFC5927]).



Wing                    Expires December 15, 2016               [Page 4]

Internet-Draft        Network Requirements for QUIC            June 2016


6.  Network State Loss

   If firewall or NAT discards mapping state (due to inactivity or other
   reason), it is beneficial for the fireall or NAT to signal the
   endpoint the mapping is destroyed.

   Recommendation: QUIC should provide a way for on-path middleboxes to
   signal that the QUIC mapping has been destroyed, so that if the QUIC
   endpoint did not want it destroyed, the QUIC endpoint can attempt to
   re-establish the connection.

7.  Network Diagnostics

   With TCP, packet loss and round-trip times can be observed by
   examining sequence and ACK numbers.  This is useful to diagnose where
   queues have formed on networks and to identify packets that were
   never received by a host.  Both RTP [RFC3550] and Secure RTP (SRTP
   [RFC3711]) were also designed to expose that information in their
   (S)RTP and (S)RTCP headers to the network to aid troubleshooting and
   diagnostics.

   Recommendation: QUIC expose acknowledgement frames to the network to
   aid diagnosting packet loss and delay.  (It is currently unclear if
   QUIC will encrypt the acknowledgement frames when QUIC adopts TLS
   1.3.)

8.  Security Considerations

   This document describes how QUIC needs to be distinguished from non-
   QUIC UDP traffic, so networks can defend themselves from attack and
   networks can defend hosts from attack.

9.  IANA Considerations

   None.

10.  References

10.1.  Normative References

   [I-D.tsvwg-quic-protocol]
              Hamilton, R., Iyengar, J., Swett, I., and A. Wilk, "QUIC:
              A UDP-Based Secure and Reliable Transport for HTTP/2",
              draft-tsvwg-quic-protocol-02 (work in progress), January
              2016.






Wing                    Expires December 15, 2016               [Page 5]

Internet-Draft        Network Requirements for QUIC            June 2016


   [RFC5927]  Gont, F., "ICMP Attacks against TCP", RFC 5927, DOI
              10.17487/RFC5927, July 2010,
              <http://www.rfc-editor.org/info/rfc5927>.

10.2.  Informative References

   [homeCPE]  various, "An Experimental Study of Home Gateway
              Characteristics", November 2010,
              <http://conferences.sigcomm.org/imc/2010/papers/p260.pdf>.

   [I-D.byrne-opsec-udp-advisory]
              Byrne, C. and J. Kleberg, "Advisory Guidelines for UDP
              Deployment", draft-byrne-opsec-udp-advisory-00 (work in
              progress), July 2015.

   [I-D.hildebrand-middlebox-erosion]
              Hildebrand, J. and P. McManus, "Erosion of the moral
              authority of transparent middleboxes", draft-hildebrand-
              middlebox-erosion-01 (work in progress), November 2014.

   [ICMPTest]
              Pal-Erik Martinsen, "ICMPTest", March 2015,
              <https://github.com/palerikm/ICMPTest>.

   [RFC3550]  Schulzrinne, H., Casner, S., Frederick, R., and V.
              Jacobson, "RTP: A Transport Protocol for Real-Time
              Applications", STD 64, RFC 3550, DOI 10.17487/RFC3550,
              July 2003, <http://www.rfc-editor.org/info/rfc3550>.

   [RFC3711]  Baugher, M., McGrew, D., Naslund, M., Carrara, E., and K.
              Norrman, "The Secure Real-time Transport Protocol (SRTP)",
              RFC 3711, DOI 10.17487/RFC3711, March 2004,
              <http://www.rfc-editor.org/info/rfc3711>.

   [RFC4787]  Audet, F., Ed. and C. Jennings, "Network Address
              Translation (NAT) Behavioral Requirements for Unicast
              UDP", BCP 127, RFC 4787, DOI 10.17487/RFC4787, January
              2007, <http://www.rfc-editor.org/info/rfc4787>.

   [RFC5780]  MacDonald, D. and B. Lowekamp, "NAT Behavior Discovery
              Using Session Traversal Utilities for NAT (STUN)", RFC
              5780, DOI 10.17487/RFC5780, May 2010,
              <http://www.rfc-editor.org/info/rfc5780>.

   [RFC6824]  Ford, A., Raiciu, C., Handley, M., and O. Bonaventure,
              "TCP Extensions for Multipath Operation with Multiple
              Addresses", RFC 6824, DOI 10.17487/RFC6824, January 2013,
              <http://www.rfc-editor.org/info/rfc6824>.



Wing                    Expires December 15, 2016               [Page 6]

Internet-Draft        Network Requirements for QUIC            June 2016


   [RFC7675]  Perumal, M., Wing, D., Ravindranath, R., Reddy, T., and M.
              Thomson, "Session Traversal Utilities for NAT (STUN) Usage
              for Consent Freshness", RFC 7675, DOI 10.17487/RFC7675,
              October 2015, <http://www.rfc-editor.org/info/rfc7675>.

   [tsvarea]  Google, "Quick UDP Internet Connections: Multiplexed
              Stream Transport over UDP", November 2013,
              <https://www.ietf.org/proceedings/88/slides/slides-88-
              tsvarea-10.pdf>.

Author's Address

   Dan Wing
   Cisco Systems, Inc.
   170 West Tasman Drive
   San Jose, California  95134
   USA

   Email: dwing@cisco.com
































Wing                    Expires December 15, 2016               [Page 7]
